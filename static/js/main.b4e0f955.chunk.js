(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{45:function(t,e,n){t.exports=n(88)},50:function(t,e,n){},51:function(t,e,n){},85:function(t,e){},88:function(t,e,n){"use strict";n.r(e);var i=n(0),o=n.n(i),a=n(43),s=n.n(a),r=(n(50),n(13)),c=n(14),l=n(16),p=n(15),u=n(17),h=(n(51),n(1));function d(t){var e={};e.value=t,e.isDown=!1,e.isUp=!0,e.press=void 0,e.release=void 0,e.downHandler=function(t){t.key===e.value&&(e.isUp&&e.press&&e.press(),e.isDown=!0,e.isUp=!1,t.preventDefault())},e.upHandler=function(t){t.key===e.value&&(e.isDown&&e.release&&e.release(),e.isDown=!1,e.isUp=!0,t.preventDefault())};var n=e.downHandler.bind(e),i=e.upHandler.bind(e);return window.addEventListener("keydown",n,!1),window.addEventListener("keyup",i,!1),e.unsubscribe=function(){window.removeEventListener("keydown",n),window.removeEventListener("keyup",i)},e}function y(t,e){return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1)}function x(t,e,n){return{x1:t.x-e/2,x2:t.x+e/2,y1:t.y-n/2,y2:t.y+n/2}}var m={appw:432,apph:304,pikaw:64,pikah:64,ballw:40,ballh:40,ground:264,poleTop:156};function f(t,e){this.x=t||0,this.y=e||0}Object.defineProperties(f.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(f.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),i=Math.sin(e),o=this.x-t.x,a=this.y-t.y;return this.x=o*n-a*i+t.x,this.y=o*i+a*n+t.y,this}});var k=function(t){function e(t){var n;Object(r.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).setScore=function(t){n.score=t;for(var e=0;e<2;e++)n.scoreSprite[e].texture=h.c.shared.resources.spritesheet.textures["digit".concat(n.score[e])];9!==t[0]&&9!==t[1]||("online-player1"===n.props.player&&9===t[0]||"online-player2"===n.props.player&&9===t[1]?(n.pika.visible=!1,n.pika=n.pikas.pika_win,n.pika.visible=!0,n.pika2.visible=!1,n.pika2=n.pikas.pika_lose.other,n.pika2.visible=!0,n.pika.gotoAndPlay(0),n.pika2.gotoAndPlay(0)):(n.pika.visible=!1,n.pika=n.pikas.pika_lose,n.pika.visible=!0,n.pika2.visible=!1,n.pika2=n.pikas.pika_win.other,n.pika2.visible=!0,n.pika.gotoAndPlay(0),n.pika2.gotoAndPlay(0)))},n.resetPos=function(t){t.pika={x:"online-player1"===n.props.player?36:394,y:232,vx:0,vy:0,ay:.8},t.pika2={x:"online-player2"===n.props.player?36:394,y:232},t.ball={x:36,y:m.ballh/2,vx:0,vy:0,ax:0,ay:.3}},n.updatePixiRoot=function(t){n.pixiRoot=t,n.pixiRoot&&n.pixiRoot.children.length<=0&&(n.pixiRoot.appendChild(n.state.app.view),n.setup())},n.setup=function(){h.c.shared.add("spritesheet","assets/spritesheet.json").load(n.onAssetsLoaded),n.left=0,n.right=0;var t=d("ArrowLeft"),e=d("ArrowUp"),i=d("ArrowRight");d("ArrowDown");t.press=function(){n.left=-1,n.pos.pika.vx=n.left+n.right},t.release=function(){n.left=0,n.pos.pika.vx=n.left+n.right},i.press=function(){n.right=1,n.pos.pika.vx=n.left+n.right},i.release=function(){n.right=0,n.pos.pika.vx=n.left+n.right},e.press=function(){n.pika.visible=!1,n.pika=n.pikas.pika_jump,n.pos.pika.y>=m.ground-m.pikah/2&&(n.pos.pika.vy=-16),n.pika.visible=!0},e.release=function(){n.pika.visible=!1,n.pika=n.pikas.pika_walk,n.pika.visible=!0}},n.onAssetsLoaded=function(t,e){var i=e.spritesheet.textures,o=e.spritesheet.spritesheet.animations,a=n.state.app;n.pikas={};var s=a.screen.width,r=a.screen.height,c=new h.e(i.bg00,s,32);c.y=r-32,a.stage.addChild(c);var l=new h.d(i.bg01a);l.y=r-48,a.stage.addChild(l),(c=new h.e(i.bg01b,s-32,16)).y=r-48,c.x=16,a.stage.addChild(c);var p=new h.d(i.bg01c);p.y=r-48,p.x=416,a.stage.addChild(p),(c=new h.e(i.bg02,a.screen.width,16)).y=r-64,a.stage.addChild(c),(c=new h.d(i.bg03)).y=r-64-72,a.stage.addChild(c),c=new h.e(i.bg04,s,r-64-72),a.stage.addChild(c),(c=new h.d(i.bg07)).x=m.appw/2-4,c.y=156,a.stage.addChild(c),(c=new h.e(i.bg08,8,108)).x=m.appw/2-4,c.y=164,a.stage.addChild(c),["pika_walk","pika_jump","pika_attack","pika_dive","pika_win","pika_lose"].forEach(function(t){var e=new h.a(o[t]),i=new h.a(o[t]);i.scale.x=-1,e.animationSpeed=.3,i.animationSpeed=.3,e.play(),i.play(),e.visible=!1,i.visible=!1,"pika_win"!==t&&"pika_lose"!==t||(e.loop=!1,i.loop=!1,e.animationSpeed=.05,i.animationSpeed=.05),a.stage.addChild(e),a.stage.addChild(i),"online-player1"===n.props.player?(n.pikas[t]=e,n.pikas[t].other=i):(n.pikas[t]=i,n.pikas[t].other=e)}),n.pika=n.pikas.pika_walk,n.pika.visible=!0,n.pika2=n.pikas.pika_walk.other,n.pika2.visible=!0,n.ball=new h.a(o.ball),n.ball.animationSpeed=.1,n.ball.play(),a.stage.addChild(n.ball);for(var u=0;u<2;u++)n.scoreSprite[u]=new h.d(i.digit0),n.scoreSprite[u].x=56+288*u,n.scoreSprite[u].y=12,a.stage.addChild(n.scoreSprite[u]);a.ticker.add(function(t){return n.gameLoop(t)}),n.props.socket.emit("round-start")},n.gameLoop=function(){var t=n.pos,e=t.pika,i=t.pika2,o=t.ball;if(e.x+=3.5*e.vx,e.vy+=e.ay,e.y+=e.vy,e.y>m.ground-m.pikah/2&&(e.y=m.ground-m.pikah/2),"online-player1"===n.props.player){e.x<m.pikaw/2?e.x=m.pikaw/2:e.x>m.appw/2-m.pikaw/2&&(e.x=m.appw/2-m.pikaw/2),o.vx+=o.ax,o.vy+=o.ay,o.x+=o.vx,o.y+=o.vy,o.x<m.ballw/2?(o.vx*=-.9,o.x=m.ballw/2):o.x>m.appw-m.ballw/2&&(o.vx*=-.9,o.x=m.appw-m.ballw/2),o.y<m.ballh/2?(o.vy*=-.9,o.y=m.ballh/2):o.y>m.ground-m.ballh/2&&(o.vy*=-.9,o.y=m.ground-m.ballh/2,9!==n.score[0]&&9!==n.score[1]&&(o.x<m.appw/2?n.score[1]++:n.score[0]++,n.setScore(n.score),n.props.socket.emit("score",n.score),n.props.socket.emit("round-end"),9!==n.score[0]&&9!==n.score[1]&&(n.resetPos(n.pos),n.props.socket.emit("round-start"))));var a=new f(o.x-m.appw,o.y-m.poleTop);if(a.length<m.ballw/2&&o.y<m.poleTop){var s=new f(o.vx,o.vy).length*a.normalize();o.vx=s.x,o.vy=s.y}else o.y+m.ballh/2>m.poleTop&&(o.x+m.ballw/2>m.appw/2&&o.x<m.appw/2?(o.x=m.appw/2-m.ballw/2,o.vx*=-1):o.x-m.ballw/2<m.appw/2&&o.x>m.appw/2&&(o.x=m.appw/2+m.ballw/2,o.vx*=-1));var r=x(e,m.pikaw,m.pikah),c=x(i,m.pikaw,m.pikah),l=x(o,m.ballw,m.ballh);if(y(r,l)||y(c,l)){var p=y(r,l)?new f(o.x-e.x,o.y-e.y):new f(o.x-i.x,o.y-i.y);p.normalize().multiplyScalar(10),o.vx=p.x,o.vy=p.y}}else"online-player2"===n.props.player&&(e.x<m.appw/2+m.pikaw/2?e.x=m.appw/2+m.pikaw/2:e.x>m.appw-m.pikaw/2&&(e.x=m.appw-m.pikaw/2));n.pika.x=e.x,n.pika.y=e.y,n.pika2.x=i.x,n.pika2.y=i.y,n.ball.x=o.x,n.ball.y=o.y,"online-player2"===n.props.player?n.props.socket.emit("room",{x:e.x,y:e.y}):"online-player1"===n.props.player&&n.props.socket.emit("room",{pika2:e,ball:o})},n.pixiRoot=null;var i=Math.min((window.innerWidth-200)/432,(window.innerHeight-200)/304);return n.state={app:new h.b({width:432,height:304,resolution:i})},n.pos={},n.resetPos(n.pos),n.score=[0,0],n.scoreSprite=[null,null],n.props.setupGame(n.pos,n.resetPos,n.setScore),n}return Object(u.a)(e,t),Object(c.a)(e,[{key:"componentWillUnmount",value:function(){h.c.shared.reset()}},{key:"render",value:function(){return o.a.createElement("div",{className:"game-page"},o.a.createElement("div",{id:"pixi-game",ref:this.updatePixiRoot}))}}]),e}(o.a.Component),v=function(t){var e=t.color;return o.a.createElement("span",{className:"dot",style:{backgroundColor:e}})};var w=function(t){var e=t.functions,n=e.connectSocket,i=(e.sendMessage,e.setUrl),a=e.setRoom,s=e.setName,r=e.enterRoom,c=e.leaveRoom,l=e.randomRoom,p=t.socket,u=t.connected,h=t.inroom,d=t.room,y=t.name,x="grey";p&&(x="yellow",u&&(x="green"));var m=p?"\u96e2\u7dda":"\u591a\u4eba\u9023\u7dda",f=p?t.functions.disconnect:n;return o.a.createElement("div",{className:"main-ui"},o.a.createElement("div",null,o.a.createElement(v,{color:x}),o.a.createElement("input",{type:"url",onChange:function(t){return i(t.target.value)},defaultValue:t.url}),o.a.createElement("input",{type:"button",value:m,onClick:f})),u?h?o.a.createElement("div",null,o.a.createElement("span",null,"\u623f\u865f: ",d,", \u73a9\u5bb6: ",y),o.a.createElement("button",{onClick:c},"\u96e2\u958b\u623f\u9593")):o.a.createElement("div",null,o.a.createElement("input",{type:"text",onChange:function(t){return a(t.target.value)},placeholder:"\u623f\u865f",defaultValue:d}),o.a.createElement("input",{type:"text",onChange:function(t){return s(t.target.value)},placeholder:"\u66b1\u7a31",defaultValue:y}),o.a.createElement("input",{type:"button",value:"\u9032\u5165\u623f\u9593",onClick:r}),o.a.createElement("input",{type:"button",value:"\u96a8\u6a5f\u914d\u5c0d",onClick:l})):void 0)},g=n(24),b=n.n(g),S=function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).initSocket=function(){var t=n.state.socket;t.on("connect",function(){n.setState({connected:!0}),console.log("connect")}),t.on("disconnect",function(e){console.log("disconnect: "+e),"io client disconnect"!==e&&n.setState({connected:!1}),"io server disconnect"===e&&t.connect()}),t.on("connect_error",function(t){console.log("connect_error: "+t)}),t.on("connect_timeout",function(e){console.log("connect_timeout: "+e),t.close()}),t.on("error",function(t){console.log("error: "+t)}),t.on("reconnecting",function(t){console.log("reconnecting: "+t)}),t.on("reconnect_failed",function(){console.log("reconnect_failed")}),t.on("getMessage",function(t){console.log(t)}),t.on("addRoom",function(t){n.setState({inroom:!0}),console.log(t)}),t.on("leaveRoom",function(t){console.log(t),n.setState({gamemode:"none",inroom:!1})}),t.on("loadGame",function(t){n.setState({gamemode:t})}),t.on("room",function(t){"online-player1"===n.state.gamemode?n.pos.pika2=t:"online-player2"===n.state.gamemode&&(n.pos.pika2=t.pika2,n.pos.ball=t.ball)}),t.on("score",function(t){n.setScore(t)}),t.on("round-start",function(){n.resetPos(n.pos)})},n.setupGame=function(t,e,i){n.pos=t,n.resetPos=e,n.setScore=i},n.functions={connectSocket:function(){n.setState(function(t){return null===t.socket?{socket:b()(n.url)}:(t.socket.disconnect(),{socket:b()(n.url)})})},disconnect:function(){n.setState(function(t){return t.socket?(t.socket.disconnect(),{socket:null,connected:!1,inroom:!1}):{}})},sendMessage:function(){n.state.socket.emit("getMessage","\u53ea\u56de\u50b3\u7d66\u767c\u9001\u8a0a\u606f\u7684 client")},setUrl:function(t){n.url=t},setRoom:function(t){n.setState({room:t})},enterRoom:function(){n.state.socket&&n.state.socket.emit("addRoom",{room:n.state.room,player:n.state.name})},leaveRoom:function(){n.state.socket&&n.state.socket.emit("leaveRoom")},setName:function(t){n.setState({name:t})},randomRoom:function(){n.state.socket&&n.state.socket.emit("randomRoom",n.state.name)}},n.state={socket:null,connected:!1,gamemode:"none",inroom:!1,room:void 0,name:"Anonymous"},n.url="http://home.ntuosc.org:4001",n}return Object(u.a)(e,t),Object(c.a)(e,[{key:"componentDidUpdate",value:function(t,e,n){console.log("Component update"),null===e.socket&&this.state.socket&&this.initSocket()}},{key:"render",value:function(){return this.state.gamemode.includes("online-player")?o.a.createElement("div",null,o.a.createElement(k,{player:this.state.gamemode,socket:this.state.socket,setupGame:this.setupGame}),o.a.createElement("button",{onClick:this.functions.leaveRoom},"\u96e2\u958b")):o.a.createElement(w,{functions:this.functions,socket:this.state.socket,connected:this.state.connected,inroom:this.state.inroom,room:this.state.room,name:this.state.name,url:this.url})}}]),e}(i.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[45,1,2]]]);
//# sourceMappingURL=main.b4e0f955.chunk.js.map